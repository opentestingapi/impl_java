package org.opentesting.modultest;

import java.security.SecureRandom;
import java.time.LocalDateTime;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Random;

import org.opentesting.dto.TestCaseCheckDTO;
import org.opentesting.dto.TestCaseDTO;
import org.opentesting.dto.TestCaseInjectionDTO;
import org.opentesting.dto.TestCaseRandomDataDTO;
import org.opentesting.dto.TestCaseReplacementValueDTO;
import org.opentesting.dto.TestCaseValidationDTO;
import org.opentesting.dto.api1dot0.TestCaseCheckDTOapi1dot0;
import org.opentesting.dto.api1dot0.TestCaseCustomParameterDTOapi1dot0;
import org.opentesting.dto.api1dot0.TestCaseDTOapi1dot0;
import org.opentesting.dto.api1dot0.TestCaseInjectionDTOapi1dot0;
import org.opentesting.dto.api1dot0.TestCaseReplacementDTOapi1dot0;
import org.opentesting.dto.api1dot0.TestCaseReplacementValueDTOapi1dot0;
import org.opentesting.dto.api1dot0.TestCaseServiceDTOapi1dot0;
import org.opentesting.dto.api1dot0.TestCaseValidationDTOapi1dot0;

/**
 * generate data for tests
 */
public class TestDataGenerator {

    private Random random = new SecureRandom();

    protected TestCaseDTO createEmptyTest() {

        TestCaseDTO tc = new TestCaseDTOapi1dot0();
        tc.setTestapi("1.0");   
        tc.setId("testid1"); 
        tc.setDescription("testdesc");
        tc.setLabels(List.of("bar", "foo")); 
        return tc;
    }    

    protected TestCaseInjectionDTO createInject() {

        String timerid = "12345";        
        
        TestCaseReplacementValueDTOapi1dot0 val = new TestCaseReplacementValueDTOapi1dot0();
        val.setOrder(1);
        val.setType(TestCaseReplacementValueDTO.TYPE_LIST);
        val.setValue("aaaa|bbbb");
        
        TestCaseReplacementDTOapi1dot0 rg = new TestCaseReplacementDTOapi1dot0();
        rg.setKey("#hallo#");
        rg.setMaxlength(3);
        rg.setValue(List.of(val));

        TestCaseInjectionDTO inject = new TestCaseInjectionDTOapi1dot0();
        inject.setInjectid("inject1");
        inject.setCron(List.of("10 * * * * * ?"));
        inject.setService(createService());
        inject.setSourcefile("source.json");
        inject.setChecks(List.of("check1"));
        inject.setReplacements(List.of(rg));
        inject.setTimerid(timerid);
        inject.setInstanceid(timerid+"_"+random.nextInt());
        inject.setStartts(LocalDateTime.now());
        return inject;
    }  

    protected TestCaseServiceDTOapi1dot0 createService() {
        
        TestCaseCustomParameterDTOapi1dot0 c = new TestCaseCustomParameterDTOapi1dot0("topic", "mytopic");
        
        TestCaseServiceDTOapi1dot0 service = new TestCaseServiceDTOapi1dot0();
        service.setConnectstring("kafka-broker");
        service.setType("kafka");
        service.setPassword("password");
        service.setUsername("username");
        service.setCustom(List.of(c));
        return service;
    }

    protected TestCaseCheckDTO createCheck(String checkid) {

        String testid = "testid";

		Map<String, String> randomdata = new HashMap<String, String>();
		randomdata.put("#hallo#", "Hallo Welt!");
        TestCaseRandomDataDTO r = new TestCaseRandomDataDTO();
        r.setDatamap(randomdata);

        TestCaseValidationDTOapi1dot0 val = new TestCaseValidationDTOapi1dot0();
        val.setOrder(1);
        val.setRequest("requestfile");
        val.setResponse(List.of("responsefile"));
        val.setType(TestCaseValidationDTO.TYPE_CONTAINS);
        
		TestCaseCheckDTO check = new TestCaseCheckDTOapi1dot0();
        check.setCheckid(checkid);
        check.setService(createService());
        check.setValidations(List.of(val));
        check.setInjects(List.of("dummy-inject-1"));
        check.setChecks(List.of("dummy-check-1"));
        check.setResult2random(List.of("attribute1"));
        check.setInstanceid(checkid+"_"+random.nextInt());
        check.setTestid(testid);
        check.setStartts(LocalDateTime.now());
        check.setTargetts(LocalDateTime.now().plusMinutes(5));
        check.setRandomdata(r);
        return check;
    }  
    
    protected List<String> getTestCases() {
        List<String> testcases = new ArrayList<String>();
		testcases.add("local_test_00001");
		testcases.add("local_test_00002");
		testcases.add("local_test_00003");
		testcases.add("local_test_00004");
		testcases.add("local_test_00005");
		testcases.add("local_test_00006");
        testcases.add("local_test_helloworld");
        return testcases;
    }

    protected String getTestCaseDir() {
        return "examples/";
    }

}

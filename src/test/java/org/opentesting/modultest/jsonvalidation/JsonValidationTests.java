package org.opentesting.modultest.jsonvalidation;

import lombok.SneakyThrows;
import org.junit.Assert;
import org.junit.jupiter.api.Test;
import org.opentesting.modultest.TestDataGenerator;
import org.opentesting.services.jsonvalidation.JsonValidator;
import org.opentesting.util.MappingHelper;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;

/**
 * test example test cases
 */
@SpringBootTest
class JsonValidationTests extends TestDataGenerator {

    @Autowired
	private JsonValidator jsonValidator;

    @Test
    @SneakyThrows
    void validateExamples() {
        for (String tc : getTestCases()) {
            String testFile = tc + "/test.json";

            String content;
            ClassLoader classLoader = JsonValidationTests.class.getClassLoader();
            if(classLoader.getResource(getTestCaseDir()+ testFile) != null) {            
                content = readFile(testFile);                
            } else {
                testFile = tc + "/test.yml";
                content = MappingHelper.jsonOrYmlToJson(readFile(testFile));
            }

            boolean result = jsonValidator.validateSchema(content, "OpenTestApiSchema_v1.0.json").isEmpty();
            Assert.assertTrue(result);
        }
    }    
    
}
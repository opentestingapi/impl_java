package org.opentesting;

import java.security.SecureRandom;
import java.time.LocalDateTime;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Random;

import org.opentesting.dto.TestCaseCheckDTO;
import org.opentesting.dto.TestCaseDTO;
import org.opentesting.dto.TestCaseInjectionDTO;
import org.opentesting.dto.TestCaseRandomDataDTO;
import org.opentesting.dto.TestCaseReplacementValueDTO;
import org.opentesting.dto.TestCaseValidationDTO;
import org.opentesting.dto.api1_0.TestCaseCheckDTOapi1_0;
import org.opentesting.dto.api1_0.TestCaseCustomParameterDTOapi1_0;
import org.opentesting.dto.api1_0.TestCaseDTOapi1_0;
import org.opentesting.dto.api1_0.TestCaseInjectionDTOapi1_0;
import org.opentesting.dto.api1_0.TestCaseReplacementDTOapi1_0;
import org.opentesting.dto.api1_0.TestCaseReplacementValueDTOapi1_0;
import org.opentesting.dto.api1_0.TestCaseServiceDTOapi1_0;
import org.opentesting.dto.api1_0.TestCaseValidationDTOapi1_0;

/**
 * generate data for tests
 */
public class TestDataGenerator {

    private Random random = new SecureRandom();

    protected TestCaseDTO createEmptyTest() {
        TestCaseDTO tc = new TestCaseDTOapi1_0("1.0", "testid1", "testdesc", null, null, true, List.of("bar", "foo"), LocalDateTime.now(), null, null);        
        return tc;
    }    

    protected TestCaseInjectionDTO createInject() {

        String timerid = "12345";        
        
        TestCaseReplacementValueDTOapi1_0 val = new TestCaseReplacementValueDTOapi1_0(
            1, TestCaseReplacementValueDTO.TYPE_LIST, "aaaa|bbbb", null);
        
        TestCaseReplacementDTOapi1_0 rg = new TestCaseReplacementDTOapi1_0("#hallo#", List.of(val), 3);

        TestCaseInjectionDTO inject = new TestCaseInjectionDTOapi1_0("inject1", List.of("10 * * * * * ?"), createService(), "1d",
                "source.json", List.of("check1"), List.of(rg), true, timerid, timerid+"_"+random.nextInt(), LocalDateTime.now(),
                null, new TestCaseRandomDataDTO(), "bulkid", "traceid");

        return inject;
    }  

    protected TestCaseServiceDTOapi1_0 createService() {
        
        TestCaseCustomParameterDTOapi1_0 c = new TestCaseCustomParameterDTOapi1_0("topic", "mytopic");
        
        return new TestCaseServiceDTOapi1_0("kafka", "kafka-broker", "user", "password", List.of(c));
    }

    protected TestCaseCheckDTO createCheck(String checkid) {

        String testid = "testid";

		Map<String, String> randomdata = new HashMap<String, String>();
		randomdata.put("#hallo#", "Hallo Welt!");
        TestCaseRandomDataDTO r = new TestCaseRandomDataDTO();
        r.setRandomdata(randomdata);

        TestCaseValidationDTOapi1_0 val = new TestCaseValidationDTOapi1_0(1, "requestfile", TestCaseValidationDTO.TYPE_CONTAINS, List.of("responsefile"));
        
		TestCaseCheckDTO check = new TestCaseCheckDTOapi1_0(checkid, createService(), List.of(val), "1d", true, 
        		false, List.of("dummy-inject-1"), List.of("dummy-check-1"), List.of("attribute1"),
				checkid+"_"+random.nextInt(), testid, LocalDateTime.now(), LocalDateTime.now().plusMinutes(5), null, null, r, "bulkid", "traceid");

        return check;
    }    

}

package org.opentesting;

import java.util.Map;

import org.junit.Assert;
import org.junit.jupiter.api.Test;
import org.opentesting.dto.migration.MigrationHelper;
import org.springframework.boot.test.context.SpringBootTest;

import lombok.SneakyThrows;

/**
 * test migration helper
 */
@SpringBootTest
class MigrationHelperTests {

    @Test
    @SneakyThrows
    void testParamToMap() {

        String input = "header=source_kafka_headers_1.json;security.protocol=SASL_PLAINTEXT;sasl.mechanism=PLAIN;login.module=org.apache.kafka.common.security.plain.PlainLoginModule;jwt-post=http://post-url/token;jwt-param=client_id=clientid&grant_type=password&username=#jwtuser#&password=#jwtpassword#;jwt-header=headerkey1=headervalue1&headerkey2=headervalue2;kafka-header-jwt=accessToken";

        Map<String,String> res = MigrationHelper.parameterToMap(input, ";");

        Assert.assertEquals("source_kafka_headers_1.json", res.get("header"));
        Assert.assertEquals("org.apache.kafka.common.security.plain.PlainLoginModule", res.get("login.module"));
        Assert.assertEquals("client_id=clientid&grant_type=password&username=#jwtuser#&password=#jwtpassword#", res.get("jwt-param"));
        Assert.assertEquals("http://post-url/token", res.get("jwt-post"));
        Assert.assertEquals("headerkey1=headervalue1&headerkey2=headervalue2", res.get("jwt-header"));
        Assert.assertEquals("accessToken", res.get("kafka-header-jwt"));
    }
    
}

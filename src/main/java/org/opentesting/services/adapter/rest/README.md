# REST

Using REST to perform inject and check

### Configuration Inject

* please use sourcefile to define POST payload
* random data replacement processed for sourcefile, header and url
* basic auth could be added as header
* please use #username# and #password# or replacement keys within your files, these ones will be replaced (passwords removed when downloading the test case)
* please use dataextraction to transfer JSON result (only JSON!) attributes to random data for later usage
* please use custom parameter senddelay in ms to define a request send delay, helpful if kafka consumer initialization is to slow (default: 0, using value > 0 will make result2random unused, you need to use dedicated checks with result2random instead)

| custom parameter | description | example |
|-----|-----|-----|
| type | request type | POST |
| header | define headers (key-value file), please use #username#, #password# or replacement keys as placeholders (optional) | check_rest_headers_1.json |
| jwtpost | POST to request token (optional) | https://server/env/gui/auth/realms/myrealm/protocol/openid-connect/token |
| jwtparam | parameters for the request; please use #username#, #password# or replacement keys as placeholders (for example #jwtpassword# could be used and will be decrypted automatically) (optional) | client_id=myclientid&grant_type=password&username=#jwtuser#&password=#jwtpassword# |
| jwtheader | header fields to be added to the jwt request (optional) | myHeaders.json |
| jwtuser | might be used to specify the user in dedicated field (optional) | myuser |
| jwtpassword | might be used to specify the password in dedicated field (optional) | myPossibillyEncryptedPassword |
| senddelay | milliseconds to delay the send, helpful if kafka consumer initialization is to slow (default: not used, using it will make result2random unused, you need to use dedicated checks with result2random instead | 15000 |

```
{
        "injectid": "inject-rest-1",
        "cron": [ "0 * * * * ?" , "30 * * * * ?" ],
        "active": true,
        "service": {
            "type": "rest",
            "connectstring": "http://localhost:50000/dummy/post",
            "username": "",
            "password": "",
            "custom": [
              {
                "key": "type",
                "value": "POST"
              },
              {
                "key": "header",
                "value": "source_rest_headers_1.json"
              },
              {
                "key": "jwtuser",
                "value": "jwtuser"
              },
              {
                "key": "jwtpassword",
                "value": "jwtpassword"
              },
              {
                "key": "jwtpost",
                "value": "jwtposturl"
              },
              {
                "key": "jwtparam",
                "value": "jwtparameters"
              },
              {
                "key": "jwtheader",
                "value": "jwtheaders"
              }
            ]
        },           
        "sourcefile": "source_rest_1.json",
        "timetolive": "5d",
        "checks": [ "check-rest-1" ],
        "dataextraction": [ 
          {
              "attribute": "test",
              "source": "payload",
              "target": "#inject-rest-1.test#"
          },{
              "attribute": "testheader",
              "source": "header",
              "target": "#inject-rest-1.testheader#",
              "regex": ".*test"
          }
        ],
        "replacements": [...]
}
```

### Configuration Check

* please use validation 'request' to define POST payload as file
* please use validation 'response' to define expected JSON result(s)
* expectedtype could be 'equals', 'contains', 'containsnot', 'containsoneof'
* random data replacement processed for: 'request', 'response', 'connectstring', 'header'
* basic auth could be added as header
* injects executed after successful check or if check finally failed and not mandatory (please do not create infinite loops)
* please use dataextraction to transfer JSON result (only JSON!) attributes to random data for later usage

| custom parameter | description | example |
|-----|-----|-----|
| type | request type | POST |
| header | define headers (key-value file), please use #username#, #password# or replacement keys as placeholders (optional) | check_rest_headers_1.json |
| jwtpost | POST to request token (optional) | https://server/env/gui/auth/realms/myrealm/protocol/openid-connect/token |
| jwtparam | parameters for the request; please use #username#, #password# or replacement keys as placeholders (for example #jwtpassword# could be used and will be decrypted automatically) (optional) | client_id=myclientid&grant_type=password&username=#jwtuser#&password=#jwtpassword# |
| jwtheader | header fields to be added to the jwt request (optional) | myHeaders.json |
| jwtuser | might be used to specify the user in dedicated field (optional) | myuser |
| jwtpassword | might be used to specify the password in dedicated field (optional) | myPossibillyEncryptedPassword |

```
{
        "checkid": "check-rest-1",  
        "active": true,
        "service": {
          "type": "rest",
          "connectstring": "http://localhost:50000/dummy/post",
          "username": "",
          "password": "",
          "custom": [
            {
              "key": "type",
              "value": "POST"
            },
            {
              "key": "header",
              "value": "check_rest_headers_1.json"
            },
            {
              "key": "jwtuser",
              "value": "jwtuser"
            },
            {
              "key": "jwtpassword",
              "value": "jwtpassword"
            },
            {
              "key": "jwtpost",
              "value": "jwtposturl"
            },
            {
              "key": "jwtparam",
              "value": "jwtparameters"
            },
            {
              "key": "jwtheader",
              "value": "jwtheaders"
            }
          ]
        },
        "validations": [
          {
              "order": 1,
              "request": "payload.json",
              "response": [ "check_rest_1.json" ],
              "type": "equals"
          }
        ],          
        "maxwaittime": "10m",
        "mandatory": false,
        "injects": [ "inject-rest-2" ],
        "checks": [ "check-rest-2" ],
        "dataextraction": [ 
          {
              "attribute": "test",
              "source": "payload",
              "target": "#check-rest-1.test#"
          },{
              "attribute": "testheader",
              "source": "header",
              "target": "#check-rest-1.testheader#",
              "regex": ".*test"
          }
        ]
}
```
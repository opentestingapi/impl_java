# Kafka

Using consumer and producer to perform inject and check

### Configuration Inject

* please use sourcefile to store message to send
* StringSerializer implemented
* please use empty user and password for unprotected topics
* random data replacement processed for: sourcefile
* please use serviceparam header to define headers (key-value), please use #connectuser#, #connectpassword#, #jwtuser#, #jwtpassword# as placeholders
* please use serviceparam jwt-post, jwt-param and jwt-header to request token, please use #connectuser#, #connectpassword#, #jwtuser#, #jwtpassword# as placeholders
* please use serviceparam kafka-header-jwt to define the kafka header key for requested JWT

```
{
        "injectid" : "inject-kafka-1",
        "triggercron" : [ "* 1 * * * ?" ],
        "activation" : true,
        "service" : "kafka",
        "serviceparam" : "header=source_kafka_headers_1.json;security.protocol=SASL_PLAINTEXT;sasl.mechanism=PLAIN;login.module=org.apache.kafka.common.security.plain.PlainLoginModule;jwt-post=http://post-url/token;jwt-param=client_id=clientid&grant_type=password&username=#jwtuser#&password=#jwtpassword#;jwt-header=headerkey1=headervalue1&headerkey2=headervalue2;kafka-header-jwt=accessToken",
        "sourcefile" : "source_kafka_1.json",
        "connectstring" : "broker=kafka-broker:9092;topic=mytopic1",
        "connectuser" : "user",
        "connectpassword" : "password",
        "jwtuser" : "jwtuser",
        "jwtpassword" : "jwtpassword",
        "timetolive": "5d",
        "checks" : [ "check-cassandra-1", "check-oracle-1" ],
        "randomgenerator" : {
          "replacements": [
               {
                   "replacement" : "#replaceme1#",
                   "optionlist": [ "rep11", "rep12", "rep13"]
               }, {
                   "replacement" : "#replaceme2#",
                   "optionlist": [ "rep21", "rep22", "rep23", "rep24"]
               }
          ]
        }
}
```

### Configuration Check

* serviceparam not required
* StringDeserializer implemented
* please use expectedfile to define expected message
* expectedtype could be 'equals' or 'contains'
* please use empty user and password for unprotected topics
* random data replacement processed for: expectedfile
* injects executed after successful check (please do not create infinite loops)
* please use result2random to transfer JSON result (only JSON!) attributes to random data for later usage

```
{
        "checkid" : "check-kafka-1",
        "activation" : true,
        "service" : "kafka",
        "serviceparam" : "security.protocol=SASL_PLAINTEXT;sasl.mechanism=PLAIN;login.module=org.apache.kafka.common.security.plain.PlainLoginModule;group.id=e2etests",
        "expectedfile" : "check_kafka_1.txt",
        "expectedtype": "contains",
        "connectstring" : "broker=kafka-broker:9092;topic=mytopic1",
        "connectuser" : "user",
        "connectpassword" : "password",
        "maxwaittime" : "1h",
        "mandatory" : true,
        "injects" : [ "check-kafka-1", "check-oracle-1" ],
        "result2random" : [ "attribute1", "attribute2" ]
}
```
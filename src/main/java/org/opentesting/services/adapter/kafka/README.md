# Kafka

Using consumer and producer to perform inject and check

### Configuration Inject

* please use sourcefile to store message to send
* StringSerializer implemented
* please use empty user and password for unprotected topics
* please use custom parameter 'topic', 'security.protocol', 'sasl.mechanism', 'login.module' to define connectivity (last 3 ones optional)
* random data replacement processed for: sourcefile
* please use custom parameter to define headers (key-value file), please use #username#, #password# or replacement keys as placeholders
* please use custom parameter jwtpost, jwtparam and jwtheader to request token, please use #username#, #password# or replacement keys as placeholders (for example #jwtpassword# could be used and will be decrypted automatically)
* please use serviceparam kafka-header-jwt to define the kafka header key for requested JWT

```
{
        "injectid": "inject-kafka-1",
        "cron" : [ "0 * * * * ?" , "12 * * * * ?", "21 * * * * ?", "30 * * * * ?", "41 * * * * ?", "52 * * * * ?" ],
        "active" : true,
        "service" : {
            "type": "kafka",
            "connectstring": "localhost:9092",
            "username": "",
            "password": "",
            "custom": [
               {
                  "key": "topic",
                  "value": "mytopic1"
               },
               {
                  "key": "security.protocol",
                  "value": "protocol"
               },
               {
                  "key": "sasl.mechanism",
                  "value": "mechanism"
               },
               {
                  "key": "login.module",
                  "value": "module"
               },
               {
                  "key": "header",
                  "value": "source_kafka_headers_1.json"
               },
               {
                  "key": "jwtuser",
                  "value": "jwtuser"
               },
               {
                  "key": "jwtpassword",
                  "value": "jwtpassword"
               },
               {
                  "key": "jwtpost",
                  "value": "jwtposturl"
               },
               {
                  "key": "jwtparam",
                  "value": "jwtparameters"
               },
               {
                  "key": "jwtheader",
                  "value": "jwtheaders"
               }
            ]
         },        
        "sourcefile" : "source_kafka_1.txt",        
        "timetolive": "5d",
        "checks" : [ "check-kafka-1" ],
        "replacements" : [...]
}
```

### Configuration Check

* validation 'request' not required
* StringDeserializer implemented
* please use validation 'response' to define expected JSON result(s)
* expectedtype could be 'equals', 'contains', 'containsnot', 'containsoneof'
* random data replacement processed for: 'response'
* please use empty user and password for unprotected topics
* please use custom parameter 'topic', 'group.id', 'security.protocol', 'sasl.mechanism', 'login.module' to define connectivity (last 3 ones optional)
* injects executed after successful check (please do not create infinite loops)
* please use result2random to transfer JSON result (only JSON!) attributes to random data for later usage

```
{
        "checkid": "check-kafka-1",  
        "active": true,
        "service": {
            "type": "kafka",
            "connectstring": "localhost:9092",
            "username": "",
            "password": "",
            "custom": [
               {
                  "key": "topic",
                  "value": "mytopic1"
               },
               {
                  "key": "group.id",
                  "value": "e2etests"
               },
               {
                  "key": "security.protocol",
                  "value": "protocol"
               },
               {
                  "key": "sasl.mechanism",
                  "value": "mechanism"
               },
               {
                  "key": "login.module",
                  "value": "module"
               },
               {
                  "key": "jwtuser",
                  "value": "jwtuser"
               },
               {
                  "key": "jwtpassword",
                  "value": "jwtpassword"
               },
               {
                  "key": "jwtpost",
                  "value": "jwtposturl"
               },
               {
                  "key": "jwtparam",
                  "value": "jwtparameters"
               },
               {
                  "key": "jwtheader",
                  "value": "jwtheaders"
               }
            ]
         },
         "validations": [
            {
               "order": 1,
               "request": "",
               "response": [ "check_kafka_1.txt" ],
               "type": "contains"
            }
         ],        
        "maxwaittime": "10m",
        "mandatory": false,
        "injects": [ "inject-rest-2" ],
        "checks": [ "check-rest-2" ],
        "result2random": [ "test1", "test2" ]
}
```